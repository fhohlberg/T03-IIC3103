{"ast":null,"code":"import _classCallCheck from \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de Integracio\\u0301n/stocks-master-tarea3/src/components/Dashboard.jsx\";\nimport React from 'react';\nimport * as bulma from \"reactbulma\";\nimport StocksList from \"./StocksList.jsx\";\nimport StocksGraph from \"./StocksGraph.jsx\";\nimport StocksLoaderStatus from \"./StocksLoaderStatus.jsx\";\nimport socketIOClient from \"socket.io-client\";\nvar stocksUrl = 'ws://le-18262636.bitzonte.com';\n\nvar Dashboard =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Dashboard, _React$Component);\n\n  function Dashboard() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Dashboard);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Dashboard)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      // stocks = {name: {current_value: 12, history: [{time: '2131', value: 45}, ...], is_selected: false}, ...}\n      stocks: {},\n      market_trend: undefined,\n      // 'up' or 'down'\n      connectionError: false\n    };\n\n    _this.componentDidMount = function () {\n      var socket = socketIOClient(stocksUrl, {\n        path: \"/stocks\"\n      });\n      socket.on(\"UPDATE\", _this.saveNewStockValues); //this.connection = new WebSocket(stocksUrl);\n      //this.connection.onmessage = this.saveNewStockValues;\n      //this.connection.onclose = () => { this.setState({connectionError: true}) }\n    };\n\n    _this.saveNewStockValues = function (event) {\n      _this.props.hideSpinner();\n\n      var up_values_count = 0,\n          down_values_count = 0; // time stored in histories should be consisitent across stocks(better for graphs)\n\n      var current_time = Date.now();\n      var new_stocks = _this.state.stocks;\n\n      if (_this.state.stocks[event.data.ticker]) {\n        new_stocks[event.data.ticker].current_value > Number(event.data.value) ? up_values_count++ : down_values_count++;\n        new_stocks[event.data.ticker].current_value = Number(event.data.value);\n        new_stocks[event.data.ticker].history.push({\n          time: event.data.time,\n          value: Number(event.data.value)\n        });\n      } else {\n        new_stocks[event.data.ticker] = {\n          current_value: event.data.value,\n          history: [{\n            time: Date.now(),\n            value: Number(event.data.value)\n          }],\n          is_selected: false\n        };\n      }\n\n      _this.setState({\n        stocks: new_stocks,\n        market_trend: _this.newMarketTrend(up_values_count, down_values_count)\n      });\n    };\n\n    _this.newMarketTrend = function (up_count, down_count) {\n      if (up_count === down_count) return undefined;\n      return up_count > down_count ? 'up' : 'down';\n    };\n\n    _this.toggleStockSelection = function (stock_name) {\n      var new_stocks = _this.state.stocks;\n      new_stocks[stock_name].is_selected = !new_stocks[stock_name].is_selected;\n\n      _this.setState({\n        stocks: new_stocks\n      });\n    };\n\n    _this.resetData = function () {\n      var new_stocks = _this.state.stocks;\n      Object.keys(_this.state.stocks).map(function (stock_name, index) {\n        new_stocks[stock_name].history = [new_stocks[stock_name].history.pop()];\n      });\n\n      _this.setState({\n        stocks: new_stocks\n      });\n    };\n\n    _this.areStocksLoaded = function () {\n      return Object.keys(_this.state.stocks).length > 0;\n    };\n\n    return _this;\n  }\n\n  _createClass(Dashboard, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, React.createElement(StocksList, {\n        stocks: this.state.stocks,\n        toggleStockSelection: this.toggleStockSelection,\n        resetData: this.resetData,\n        market_trend: this.state.market_trend,\n        areStocksLoaded: this.areStocksLoaded,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78\n        },\n        __self: this\n      }), React.createElement(StocksGraph, {\n        stocks: this.state.stocks,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: this.props.showSpinner ? 'modal is-active' : 'modal',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"modal-background\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"modal-content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }, React.createElement(StocksLoaderStatus, {\n        connectionError: this.state.connectionError,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90\n        },\n        __self: this\n      }))));\n    }\n  }]);\n\n  return Dashboard;\n}(React.Component);\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/francisca/iCloud Drive (archivo)/Documents/Documentos - MacBook Pro de Francisca/ING 9 SEMESTRE/Taller de IntegracioÌn/stocks-master-tarea3/src/components/Dashboard.jsx"],"names":["React","bulma","StocksList","StocksGraph","StocksLoaderStatus","socketIOClient","stocksUrl","Dashboard","state","stocks","market_trend","undefined","connectionError","componentDidMount","socket","path","on","saveNewStockValues","event","props","hideSpinner","up_values_count","down_values_count","current_time","Date","now","new_stocks","data","ticker","current_value","Number","value","history","push","time","is_selected","setState","newMarketTrend","up_count","down_count","toggleStockSelection","stock_name","resetData","Object","keys","map","index","pop","areStocksLoaded","length","showSpinner","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport * as bulma from \"reactbulma\";\nimport StocksList from \"./StocksList.jsx\";\nimport StocksGraph from \"./StocksGraph.jsx\";\nimport StocksLoaderStatus from \"./StocksLoaderStatus.jsx\";\nimport socketIOClient from \"socket.io-client\";\n\nconst stocksUrl = 'ws://le-18262636.bitzonte.com';\n\nclass Dashboard extends React.Component {\n\n  state = {\n  // stocks = {name: {current_value: 12, history: [{time: '2131', value: 45}, ...], is_selected: false}, ...}\n   stocks: {},\n   market_trend: undefined, // 'up' or 'down'\n   connectionError: false\n  }\n\n  componentDidMount = () => {\n    const socket = socketIOClient(stocksUrl, {path: \"/stocks\"});\n    socket.on(\"UPDATE\", this.saveNewStockValues);\n    //this.connection = new WebSocket(stocksUrl);\n    //this.connection.onmessage = this.saveNewStockValues;\n    //this.connection.onclose = () => { this.setState({connectionError: true}) }\n  }\n\n  saveNewStockValues = (event) => {\n    this.props.hideSpinner();\n    let [up_values_count, down_values_count] = [0, 0];\n\n    // time stored in histories should be consisitent across stocks(better for graphs)\n    let current_time = Date.now();\n    let new_stocks = this.state.stocks\n\n    if(this.state.stocks[event.data.ticker])\n    {\n      new_stocks[event.data.ticker].current_value > Number(event.data.value) ? up_values_count++ : down_values_count++;\n\n      new_stocks[event.data.ticker].current_value = Number(event.data.value)\n      new_stocks[event.data.ticker].history.push({time: event.data.time, value: Number(event.data.value)})\n    }\n    else\n    {\n      new_stocks[event.data.ticker] = { current_value: event.data.value, history: [{time: Date.now(), value: Number(event.data.value)}], is_selected: false }\n    }\n    this.setState({stocks: new_stocks, market_trend: this.newMarketTrend(up_values_count, down_values_count)})\n  }\n\n  // it's about the values that just came in, and not all the stocks\n  newMarketTrend = (up_count, down_count) => {\n    if(up_count === down_count) return undefined;\n    return up_count > down_count ? 'up' : 'down'\n  }\n\n  toggleStockSelection = (stock_name) => {\n    let new_stocks = this.state.stocks;\n    new_stocks[stock_name].is_selected = !new_stocks[stock_name].is_selected\n    this.setState({ stocks: new_stocks })\n  }\n\n  resetData = () => {\n    let new_stocks = this.state.stocks;\n    Object.keys(this.state.stocks).map((stock_name, index) =>\n    {\n      new_stocks[stock_name].history = [new_stocks[stock_name].history.pop()];\n    });\n    this.setState({ stocks: new_stocks });\n  }\n\n  areStocksLoaded = () => {\n    return Object.keys(this.state.stocks).length > 0;\n  }\n\n  render() {\n    return (\n      <div className='container'>\n        <div className='columns'>\n          <StocksList\n            stocks={this.state.stocks}\n            toggleStockSelection={this.toggleStockSelection}\n            resetData={this.resetData}\n            market_trend={this.state.market_trend}\n            areStocksLoaded={this.areStocksLoaded}\n          />\n          <StocksGraph stocks={this.state.stocks} />\n        </div>\n        <div className={ this.props.showSpinner ? 'modal is-active' : 'modal' }>\n          <div className=\"modal-background\"></div>\n          <div className=\"modal-content\">\n            <StocksLoaderStatus connectionError={this.state.connectionError} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Dashboard;\n"]},"metadata":{},"sourceType":"module"}